function $(){const n=document,u=document.body,a=n.querySelector(".site-header"),c=n.querySelector("[data-site-nav]"),r=n.querySelector("[data-nav-toggle]"),f=Array.from(n.querySelectorAll(".site-nav__link")),o=Array.from(n.querySelectorAll("[data-section]")),d=n.querySelector("[data-current-year]");d&&(d.textContent=String(new Date().getFullYear()));function s(i){!c||!r||(r.setAttribute("aria-expanded",String(i)),c.classList.toggle("is-open",i),u.classList.toggle("nav-open",i))}r&&c&&(r.addEventListener("click",()=>{const v=!(r.getAttribute("aria-expanded")==="true");if(s(v),v){const L=c.querySelector(".site-nav__link");L&&L.focus()}}),f.forEach(i=>{i.addEventListener("click",()=>{s(!1)})}),n.addEventListener("click",i=>{if(r.getAttribute("aria-expanded")!=="true")return;const v=i.target;!c.contains(v)&&!r.contains(v)&&s(!1)}),n.addEventListener("keydown",i=>{i.key==="Escape"&&s(!1)}),window.addEventListener("resize",()=>{window.innerWidth>1200&&s(!1)}));const g={rootMargin:"-50% 0px -40% 0px",threshold:0};if("IntersectionObserver"in window){const i=new IntersectionObserver(v=>{v.forEach(L=>{if(!L.isIntersecting)return;const A=L.target.getAttribute("id");f.forEach(y=>{const l=y.dataset.navTarget===A;if(y.dataset.active=l?"true":"false",l){const t=new CustomEvent("navigation:active",{detail:{target:y}});document.dispatchEvent(t)}})})},g);o.forEach(v=>i.observe(v))}function h(){if(!a)return;const i=window.scrollY>24;a.classList.toggle("is-scrolled",i)}h(),window.addEventListener("scroll",h,{passive:!0})}function _(){const n=document,u=n.querySelector(".site-nav__list");if(!u)return;let a=u.querySelector(".magic-line");if(!a)return;const c=Array.from(n.querySelectorAll(".site-nav__link"));function r(o){if(!o){a.style.transform="translateX(0)",a.style.width="0px";return}const d=o.getBoundingClientRect(),s=u.getBoundingClientRect(),g=d.left-s.left,h=d.width;a.style.transform=`translateX(${g}px)`,a.style.width=`${h}px`}c.forEach(o=>{o.addEventListener("mouseenter",()=>r(o))}),u.addEventListener("mouseleave",()=>{const o=u.querySelector('.site-nav__link[data-active="true"]');r(o)}),document.addEventListener("navigation:active",o=>{r(o.detail.target)});const f=u.querySelector('.site-nav__link[data-active="true"]');f&&r(f)}function C(){const n=document,u=document.body,a=window.matchMedia("(prefers-reduced-motion: reduce)"),c=window.matchMedia("(pointer: fine)"),r="IntersectionObserver"in window;let f=null,o=null,d=null,s=Array.from(n.querySelectorAll("[data-reveal]")),g=a.matches;function h(e){g=e,u.dataset.reducedMotion=e?"true":"false"}h(g);function i(e,l){typeof e.addEventListener=="function"?e.addEventListener("change",l):typeof e.addListener=="function"&&e.addListener(l)}i(a,e=>{h(e.matches),y()}),i(c,()=>{y()});function v(){if(typeof f=="function"&&(f(),f=null),g||!c.matches)return;const e=n.querySelector("[data-parallax-root]");if(!e)return;const l=Array.from(e.querySelectorAll("[data-parallax-layer]"));if(!l.length)return;let t=!1;function S(p,m){l.forEach(w=>{const x=Number(w.dataset.parallaxLayer)||.15,M=(p-.5)*x*40,q=(m-.5)*x*40;w.style.transform=`translate3d(${M.toFixed(2)}px, ${q.toFixed(2)}px, 0)`})}function b(p){t||(t=!0,window.requestAnimationFrame(()=>{const m=e.getBoundingClientRect(),w=(p.clientX-m.left)/m.width,x=(p.clientY-m.top)/m.height;S(w,x),t=!1}))}function E(){l.forEach(p=>{p.style.transform="translate3d(0,0,0)"})}e.addEventListener("pointermove",b),e.addEventListener("mouseleave",E),f=()=>{e.removeEventListener("pointermove",b),e.removeEventListener("mouseleave",E),E()}}function L(){if(typeof o=="function"&&(o(),o=null),g||!c.matches)return;const e=Array.from(n.querySelectorAll(".tilt-card"));if(!e.length)return;const l=[];e.forEach(t=>{const S=()=>{t.style.transition="transform 0.35s ease"},b=p=>{const m=t.getBoundingClientRect(),w=(p.clientX-m.left)/m.width-.5,M=(((p.clientY-m.top)/m.height-.5)*-6).toFixed(2),q=(w*6).toFixed(2);t.style.transform=`rotateX(${M}deg) rotateY(${q}deg)`},E=()=>{t.style.transform="rotateX(0deg) rotateY(0deg)"};t.addEventListener("pointerenter",S),t.addEventListener("pointermove",b),t.addEventListener("pointerleave",E),l.push(()=>{t.removeEventListener("pointerenter",S),t.removeEventListener("pointermove",b),t.removeEventListener("pointerleave",E),t.style.transform="none",t.style.transition=""})}),o=()=>{l.forEach(t=>t()),o=null}}function A(){if(s=Array.from(n.querySelectorAll("[data-reveal]")),!!s.length){if(!r){s.forEach(e=>e.classList.add("is-visible"));return}if(d&&(d.disconnect(),d=null),g){s.forEach(e=>e.classList.add("is-visible"));return}d=new IntersectionObserver((e,l)=>{e.forEach(t=>{t.isIntersecting&&(t.target.classList.add("is-visible"),l.unobserve(t.target))})},{threshold:.2}),s.forEach(e=>{e.classList.contains("is-visible")||d.observe(e)})}}function y(){v(),L(),A()}window.refreshMotionBehaviors=y,y()}function F(){const n=document.getElementById("contact-form");n&&n.addEventListener("submit",u=>{u.preventDefault();const a=new FormData(n),c=a.get("name")||"",r=a.get("email")||"",f=a.get("message")||"",o=n.dataset.mailto||"mailto:hello@mohamedalimabrouki.com?subject=Project%20enquiry",d=o.includes("?")?"&":"?",s=`${o}${d}body=${encodeURIComponent(`${c?`Name: ${c}
`:""}${r?`Email: ${r}

`:""}${f}`)}`;window.location.href=s})}function k(){$(),_(),C(),F()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();document.addEventListener("projects:hydrated",()=>{window.refreshMotionBehaviors&&window.refreshMotionBehaviors()});
